import pandas as pd
from src.feature_engineering import scale_features, add_decade_column

def test_scale_features():
    raw_data = {
        # Generate 50 random values for these columns : 'danceability', 'energy', 'loudness', 'acousticness', 'instrumentalness', 'valence', 'tempo'
        'danceability': [0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.3, 0.5],
        'energy': [0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8, 0.5, 0.7, 0.9, 0.4, 0.6, 0.8],
        'loudness': [-5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5, -5, -7, -6, -5.5, -6.5],
        'acousticness': [0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25, 0.1, 0.3, 0.2, 0.15, 0.25],
        'instrumentalness': [0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05, 0.05, 0.07, 0.06, 0.04, 0.05],
        'valence': [0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35, 0.2, 0.4, 0.3, 0.25, 0.35],
        'tempo': [177, 155, 77, 208, 157, 164, 138, 92, 70, 191, 210, 224, 106, 222, 93, 165, 116, 221, 174, 197, 99, 77, 115, 185, 69, 205, 128, 38, 69, 212, 193, 177, 162, 196, 222, 43, 44, 143, 98, 166, 175, 116, 189, 101, 181, 186, 115, 228, 214, 126]
    }
    df = pd.DataFrame(raw_data)
    features = list(df.columns)
    df = scale_features(df, features)
    
    print(df[features].mean().abs().sum())
    print(df[features].std().round(2).sum())
    assert df[features].mean().abs().sum() < 1e-6 
    assert df[features].std().round(2).sum() > len(features) - 0.1 and df[features].std().round(2).sum() < len(features) + 0.1 

def test_assign_decade_column():
    raw_data = {'track_album_release_year': [1955, 1965, 1975, 1985, 1995, 2005, 2015, 2025]}
    df = pd.DataFrame(raw_data)
    df = add_decade_column(df)
    
    expected_decades = ["1950's", "1960's", "1970's", "1980's", "1990's", "2000's", "2010's", "2020's"]
    assert df['decade'].tolist() == expected_decades
